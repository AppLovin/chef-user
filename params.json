{"name":"User Chef Cookbook","tagline":"A convenient Chef LWRP to manage user accounts and SSH keys","body":"[![Build Status](https://secure.travis-ci.org/fnichol/chef-user.png?branch=master)](http://travis-ci.org/fnichol/chef-user)\r\n\r\n## <a name=\"description\"></a> Description\r\n\r\nA convenient Chef LWRP to manage user accounts and SSH keys. This is **not**\r\nthe Opscode *users* cookbook.\r\n\r\n* Website: http://fnichol.github.io/chef-user/\r\n* Opscode Community Site: http://community.opscode.com/cookbooks/user\r\n* Source Code: https://github.com/fnichol/chef-user\r\n\r\n## <a name=\"usage\"></a> Usage\r\n\r\nSimply include `recipe[user]` in your run\\_list and the `user_account`\r\nresource will be available.\r\n\r\nTo use `recipe[user::data_bag]`, include it in your run\\_list and have a\r\ndata bag called `\"users\"` with an item like the following:\r\n\r\n    {\r\n      \"id\"        : \"hsolo\",\r\n      \"comment\"   : \"Han Solo\",\r\n      \"home\"      : \"/opt/hoth/hsolo\",\r\n      \"groups\"    : [\"admin\", \"www-data\"]\r\n      \"ssh_keys\"  : [\"123...\", \"456...\"]\r\n    }\r\n\r\nor a user to be removed:\r\n\r\n    {\r\n      \"id\"      : \"lando\",\r\n      \"action\"  : \"remove\"\r\n    }\r\n\r\nThe data bag recipe will iterate through a list of usernames defined in\r\n`node['users']` (by default) and attempt to pull in the user's information\r\nfrom the data bag item. In other words, having:\r\n\r\n    node['users'] = ['hsolo']\r\n\r\nwill set up the `hsolo` user information and not use the `lando` user\r\ninformation.\r\n\r\n## <a name=\"requirements\"></a> Requirements\r\n\r\n### <a name=\"requirements-chef\"></a> Chef\r\n\r\nTested on 0.10.8 but newer and older version should work just fine. File an\r\n[issue][issues] if this isn't the case.\r\n\r\n### <a name=\"requirements-platform\"></a> Platform\r\n\r\nThe following platforms have been tested with this cookbook, meaning that the\r\nrecipes run on these platforms without error:\r\n\r\n* ubuntu\r\n* debian\r\n* mac_os_x\r\n\r\n### <a name=\"requirements-cookbooks\"></a> Cookbooks\r\n\r\nThere are **no** external cookbook dependencies.\r\n\r\n## <a name=\"installation\"></a> Installation\r\n\r\nDepending on the situation and use case there are several ways to install\r\nthis cookbook. All the methods listed below assume a tagged version release\r\nis the target, but omit the tags to get the head of development. A valid\r\nChef repository structure like the [Opscode repo][chef_repo] is also assumed.\r\n\r\n### <a name=\"installation-platform\"></a> From the Community Site\r\n\r\nTo install this cookbook from the Community Site, use the *knife* command:\r\n\r\n    knife cookbook site install user\r\n\r\n### <a name=\"installation-berkshelf\"></a> Using Berkshelf\r\n\r\n[Berkshelf][berkshelf] is a cookbook dependency manager and development\r\nworkflow assistant. To install Berkshelf:\r\n\r\n    cd chef-repo\r\n    gem install berkshelf\r\n    berks init\r\n\r\nTo use the Community Site version:\r\n\r\n    echo \"cookbook 'user'\" >> Berksfile\r\n    berks install\r\n\r\nOr to reference the Git version:\r\n\r\n    repo=\"fnichol/chef-user\"\r\n    latest_release=$(curl -s https://api.github.com/repos/$repo/git/refs/tags \\\r\n    | ruby -rjson -e '\r\n      j = JSON.parse(STDIN.read);\r\n      puts j.map { |t| t[\"ref\"].split(\"/\").last }.sort.last\r\n    ')\r\n    cat >> Berksfile <<END_OF_BERKSFILE\r\n    cookbook 'user',\r\n      :git => 'git://github.com/$repo.git', :branch => '$latest_release'\r\n    END_OF_BERKSFILE\r\n    berks install\r\n\r\n### <a name=\"installation-librarian\"></a> Using Librarian-Chef\r\n\r\n[Librarian-Chef][librarian] is a bundler for your Chef cookbooks.\r\nTo install Librarian-Chef:\r\n\r\n    cd chef-repo\r\n    gem install librarian\r\n    librarian-chef init\r\n\r\nTo use the Opscode platform version:\r\n\r\n    echo \"cookbook 'user'\" >> Cheffile\r\n    librarian-chef install\r\n\r\nOr to reference the Git version:\r\n\r\n    repo=\"fnichol/chef-user\"\r\n    latest_release=$(curl -s https://api.github.com/repos/$repo/git/refs/tags \\\r\n    | ruby -rjson -e '\r\n      j = JSON.parse(STDIN.read);\r\n      puts j.map { |t| t[\"ref\"].split(\"/\").last }.sort.last\r\n    ')\r\n    cat >> Cheffile <<END_OF_CHEFFILE\r\n    cookbook 'user',\r\n      :git => 'git://github.com/$repo.git', :ref => '$latest_release'\r\n    END_OF_CHEFFILE\r\n    librarian-chef install\r\n\r\n## <a name=\"recipes\"></a> Recipes\r\n\r\n### <a name=\"recipes-default\"></a> default\r\n\r\nThis recipe is a no-op and does nothing.\r\n\r\n### <a name=\"recipes-data-bag\"></a> data_bag\r\n\r\nProcesses a list of users with data drawn from a data bag. The default data bag\r\nis `users` and the list of user account to create on this node is set on\r\n`node['users']`.\r\n\r\n## <a name=\"attributes\"></a> Attributes\r\n\r\n### <a name=\"attributes-home-root\"></a> home_root\r\n\r\nThe default parent path of a user's home directory. Each resource can override\r\nthis value which varies by platform. Generally speaking, the default value is\r\n`\"/home\"`.\r\n\r\n### <a name=\"attributes-default-shell\"></a> default_shell\r\n\r\nThe default user shell given to a user. Each resource can override this value\r\nwhich varies by platform. Generally speaking, the default value is\r\n`\"/bin/bash\"`.\r\n\r\n### <a name=\"attributes-manage-home\"></a> manage_home\r\n\r\nWhether of not to manage the home directory of a user by default. Each resource\r\ncan override this value. The are 2 valid states:\r\n\r\n* `\"true\"`, `true`, or `\"yes\"`: will manage the user's home directory.\r\n* `\"false\"`, `false`, or `\"no\"`: will not manage the user's home directory.\r\n\r\nThe default is `true`.\r\n\r\n### <a name=\"attributes-create-user-group\"></a> create_group\r\n\r\nWhether or not to to create a group with the same name as the user by default.\r\nEach resource can override this value. The are 2 valid states:\r\n\r\n* `\"true\"`, `true`, or `\"yes\"`: will create a group for the user by default.\r\n* `\"false\"`, `false`, or `\"no\"`: will not create a group for the user by default.\r\n\r\nThe default is `true`.\r\n\r\n### <a name=\"attributes-ssh-keygen\"></a> ssh_keygen\r\n\r\nWhether or not to generate an SSH keypair for the user by default. Each\r\nresource can override this value. There are 2 valid states:\r\n\r\n* `\"true\"`, `true`, or `\"yes\"`: will generate an SSH keypair when the account\r\n  is created.\r\n* `\"false\"`, `false`, or `\"no\"`: will not generate an SSH keypair when the account\r\n  is created.\r\n\r\nThe default is `true`.\r\n\r\n### <a name=\"attributes-data-bag-name\"></a> data_bag_name\r\n\r\nThe data bag name containing a group of user account information. This is used\r\nby the `data_bag` recipe to use as a database of user accounts.\r\n\r\nThe default is `\"users\"`.\r\n\r\n### <a name=\"attributes-user-array-node-attr\"></a> user_array_node_attr\r\n\r\nThe node attributes containing an array of users to be managed. If a nested\r\nhash in the node's attributes is required, then use a `/` between subhashes.\r\nFor example, if the users' array is stored in `node['system']['accounts']`),\r\nthen set `node['user']['user_array_node_attr']` to `\"system/accounts\"`.\r\n\r\nThe default is `\"users\"`.\r\n\r\n## <a name=\"lwrps\"></a> Resources and Providers\r\n\r\n### <a name=\"lwrps-ua\"></a> user_account\r\n\r\n**Note:** in order to use the `password` attribute, you must have the\r\n[ruby-shadow gem][ruby-shadow_gem] installed. On Debian/Ubuntu you can get\r\nthis by installing the \"libshadow-ruby1.8\" package.\r\n\r\n### <a name=\"lwrps-ua-actions\"></a> Actions\r\n\r\n<table>\r\n  <thead>\r\n    <tr>\r\n      <th>Action</th>\r\n      <th>Description</th>\r\n      <th>Default</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr>\r\n      <td>create</td>\r\n      <td>\r\n        Create the user, its home directory, <code>.ssh/authorized_keys</code>,\r\n        and <code>.ssh/{id_dsa,id_dsa.pub}</code>.\r\n      </td>\r\n      <td>Yes</td>\r\n    </tr>\r\n    <tr>\r\n      <td>remove</td>\r\n      <td>Remove the user account.</td>\r\n      <td>&nbsp;</td>\r\n    </tr>\r\n    <tr>\r\n      <td>modify</td>\r\n      <td>Modiy the user account.</td>\r\n      <td>&nbsp;</td>\r\n    </tr>\r\n    <tr>\r\n      <td>manage</td>\r\n      <td>Manage the user account.</td>\r\n      <td>&nbsp;</td>\r\n    </tr>\r\n    <tr>\r\n      <td>lock</td>\r\n      <td>Lock the user's password.</td>\r\n      <td>&nbsp;</td>\r\n    </tr>\r\n    <tr>\r\n      <td>unlock</td>\r\n      <td>Unlock the user's password.</td>\r\n      <td>&nbsp;</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n### <a name=\"lwrps-ua-attributes\"></a> Attributes\r\n\r\n<table>\r\n  <thead>\r\n    <tr>\r\n      <th>Attribute</th>\r\n      <th>Description</th>\r\n      <th>Default Value</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr>\r\n      <td>username</td>\r\n      <td><b>Name attribute:</b> The name of the user.</td>\r\n      <td><code>nil</code></td>\r\n    </tr>\r\n    <tr>\r\n      <td>comment</td>\r\n      <td>Gecos/Comment field.</td>\r\n      <td><code>nil</code></td>\r\n    </tr>\r\n    <tr>\r\n      <td>uid</td>\r\n      <td>The numeric user id.</td>\r\n      <td><code>nil</code></td>\r\n    </tr>\r\n    <tr>\r\n      <td>gid</td>\r\n      <td>The primary group id.</td>\r\n      <td><code>nil</code></td>\r\n    </tr>\r\n    <tr>\r\n      <td>home</td>\r\n      <td>Home directory location.</td>\r\n      <td><code>\"#{node['user']['home_root']}/#{username}</code></td>\r\n    </tr>\r\n    <tr>\r\n      <td>shell</td>\r\n      <td>The login shell.</td>\r\n      <td><code>node['user']['default_shell']</code></td>\r\n    </tr>\r\n    <tr>\r\n      <td>password</td>\r\n      <td>Shadow hash of password.</td>\r\n      <td><code>nil</code></td>\r\n    </tr>\r\n    <tr>\r\n      <td>system_user</td>\r\n      <td>Whether or not to create a system user.</td>\r\n      <td><code>false</code></td>\r\n    </tr>\r\n    <tr>\r\n      <td>manage_home</td>\r\n      <td>Whether or not to manage the home directory.</td>\r\n      <td><code>true</code></td>\r\n    </tr>\r\n    <tr>\r\n      <td>create_group</td>\r\n      <td>\r\n        Whether or not to to create a group with the same name as the user.\r\n      </td>\r\n      <td><code>node['user']['create_group']</code></td>\r\n    </tr>\r\n    <tr>\r\n      <td>ssh_keys</td>\r\n      <td>\r\n        A <b>String</b> or <b>Array</b> of SSH public keys to populate the\r\n        user's <code>.ssh/authorized_keys</code> file.\r\n      </td>\r\n      <td><code>[]</code></td>\r\n    </tr>\r\n    <tr>\r\n      <td>ssh_keygen</td>\r\n      <td>Whether or not to generate an SSH keypair for the user.</td>\r\n      <td><code>node['user']['ssh_keygen']</code></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n#### <a name=\"lwrps-ua-examples\"></a> Examples\r\n\r\n##### Creating a User Account\r\n\r\n    user_account 'hsolo' do\r\n      comment   'Han Solo'\r\n      ssh_keys  ['3dc348d9af8027df7b9c...', '2154d3734d609eb5c452...']\r\n      home      '/opt/hoth/hsolo'\r\n    end\r\n\r\n##### Locking a User Account\r\n\r\n    user_account 'lando' do\r\n      action  :lock\r\n    end\r\n\r\n##### Removing a User account\r\n\r\n    user_account 'obiwan' do\r\n      action  :remove\r\n    end\r\n\r\n## <a name=\"development\"></a> Development\r\n\r\n* Source hosted at [GitHub][repo]\r\n* Report issues/Questions/Feature requests on [GitHub Issues][issues]\r\n\r\nPull requests are very welcome! Make sure your patches are well tested.\r\nIdeally create a topic branch for every separate change you make.\r\n\r\n## <a name=\"license\"></a> License and Author\r\n\r\nAuthor:: [Fletcher Nichol][fnichol] (<fnichol@nichol.ca>) [![endorse](http://api.coderwall.com/fnichol/endorsecount.png)](http://coderwall.com/fnichol)\r\n\r\nCopyright 2011, Fletcher Nichol\r\n\r\nLicensed under the Apache License, Version 2.0 (the \"License\");\r\nyou may not use this file except in compliance with the License.\r\nYou may obtain a copy of the License at\r\n\r\n    http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing, software\r\ndistributed under the License is distributed on an \"AS IS\" BASIS,\r\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\nSee the License for the specific language governing permissions and\r\nlimitations under the License.\r\n\r\n[berkshelf]:      http://berkshelf.com/\r\n[chef_repo]:    https://github.com/opscode/chef-repo\r\n[cheffile]:     https://github.com/applicationsonline/librarian/blob/master/lib/librarian/chef/templates/Cheffile\r\n[kgc]:          https://github.com/websterclay/knife-github-cookbooks#readme\r\n[librarian]:    https://github.com/applicationsonline/librarian#readme\r\n[ruby-shadow_gem]:  https://rubygems.org/gems/ruby-shadow\r\n\r\n[repo]:         https://github.com/fnichol/chef-user\r\n[issues]:       https://github.com/fnichol/chef-user/issues\r\n","google":"UA-29670723-1","note":"Don't delete this file! It's used internally to help with page regeneration."}